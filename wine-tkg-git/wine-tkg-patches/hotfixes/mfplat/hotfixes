#!/bin/bash

# Apply changes related Media Foundation, DirectShow runtime and filters and Wine Gstreamer support from 7.14+
if ( cd "${srcdir}"/"${_winesrcdir}" && git merge-base --is-ancestor 4853f65c844de8277b8b0420df1a2cdb1c5b17c8 HEAD  && ! git merge-base --is-ancestor 8c8cf0896bf80ce5a30fff84a944dd29c550aefb HEAD ); then # https://github.com/wine-staging/wine-staging/commit/05ea40b9366e4ee28a2baa461853b778230cbad1
  warning "Hotfix: Use mfplat streaming support patches directly from Wine-7.14+"
  _hotfix_mainlinebackports+=(603130cc3837524b3c2f6d4338261c3b8ea802ad 65cb088386bb90840ea2535c01079d83cc74eb65 1d99367ed59a24fced9b1d3228e8a0210dd9c907 07cf1313c33c329c0b3201ee1be0e0c3fe0d20c3 a419ff8b6fcb53abf258129c9647ecff1626b01c 78b6f417f90f5247f7a2b2ea59c3321f35e4990e 4662dbd796a8feac494de1ae26c6ab6005e829da 7da1828c4927faec011d1c15d2f3f9bbb43435b7 5144b27661fcd6705353d832e0383085f8afe842 28c9c138d2658a4c3252a94d45a1e8b7ac28be7f 0c59cfc14e33a5706c1873151780d5b2dcc536ca a4be9e85687f7a8d7476ee3d3ced80eeec720f57 d2f653a854ccd17688813d6b7f585acbfb45b9ba aa867c6cfba48a63179088ec6381c73488853659 9196fee58349558593fd7edf4768b189c25f6293 227a1275b14a2ffd71a4d0c621cb655e3576ad02 cd90f650df483eddd73c53319b2e1f5bddfb3f25 71ee9086908f690aca0e58df3a29e51457758887 2388ba40d6c8bae81b4d2c50cf19234758952a67 6506533f716daf76044e663e188aab0245516deb 7f0c59f360eaba2ff4f343ac54884feb4e50a73a 05d3b1d8f31890c36dd3601e2cc0f2ab41385734 0fb1d1f2aea5138c322738dfe73a52cf516d0b38 9b6a229b4f1e0d98d9096707351b1ed9519d76c1 de243ad2188ed9ff21185f32fce13357bc98588a 02c3bc5fc50040cf64ba92af137859378f8d1cee 572876ee0ae99969d455e7421571469edfeb8353 506963aaea8e3c6e4820884b3308da27f435e580 64e2921ef3032779cf78ac000f1700e9bb3a86fc 3c2e6efb5a6b077ccd6eac2190e16829882ee333 446bb1ebf6618383a4f81864a17bbaf2d6abe2b1 f6fbac01dbd49a39a8bdf9599c886723f3da2abf ce152acdf5394f56543d3cfadd682bd9760b9b7c 0ecde5505c7eccd00ff358abc9c1a9687e8fd83d 6a7428a0fae887cecf2e97b9cab9de9cf7811446 7a4aafdad87a8dd6e82ae57a2bfdb63d608e9e8b 6860e9ab29f4fbcfe35cb0519cfe94b94f54a36f 24e546779f4e0fa86b20fe0c4023b44f019fbd25 6834fc5c9dd11026261aaa723d9df29d373ebdf5 4b36913660bfedb7e0b73c6ab1ea40caf63a9170 2d7c37da495cc25d14f5b2761a5d7e2a2111320a dfce20f34322e4d4087edf0e5f065ae7a2493151 648ea45b810f54e5da69a239a4198c3f48b4c7e2 3dd1aefc682adff082d2ae267a230f684dc1e9c4 f71c51cb19fd694ad9e169ecc37767a93bbe40aa 651e4002ceeb9a15b11a184b5f47a732e26b7e00 e4258d529342cc1dc486a136d0f715520b3dd5da 8adb6d80d595d8aea52762fd9802385e31a5a2cc 135bdc21e8f8f2a3513f9bce6390f5f386bdc861 cc9722e4e03f33ded23ac74acc7756f26b115bce 44c9ea50432771258e9eed012967a16c6f132fe9 20c4896b125c7926e57091aa3dbd82a6af1d2be4 52b5caa48884d4798e02d7cedba596da6a757aec c71ac52389f5949864f10da06950373891f8078c 3f84ee1eb6637602e3e95fee20985444639b4602 aca4537c8645c991745f85ef883b97f84e4ba5cc 962b4325e5b9e97c1594e2ea03cb44659367912b 606505e5643d8df2a23a2cc074fa9b6b2ae8b05f f38369416f6487013bf197d70420bd9feef7e485 aa9aa7390f5d689f4ca39cbec98b9c0dd7f2e1db bd18fa2099d564b6a28672f06978e3bfe0fd74cc 235effd902a4c5f25ec7244d37875091beba58a6 7348ac682693885350dff3188c51bc9a4d7966f0 9e32d45d982ef6fb84f5fb1143099eb3827ce083 af3fcc3f3ef14eb25781855f63ca44d1e1383aa9 edef14126cbdb64dda218688a51b6e170cb4909b 7735b4800685f94ed2eaaecd4461fcffaf19dfe8 8ce0ab9739e76544dcd59e2496b6da6ecb928b4d b5d6c5992092fd0c96deacbe892668aba6759f93 ebd2b7d7049e46b37caad7b0235064d1a7ec3104 55282e0d0988b66809ddb58b9f3b7449f8284fc1 db41b2ae238da4a8f73060948e94b8bdc64f64bb 5861379d6df87562753322e251261868943e91ca bcd39c5061768d6d9a822cb8f8effa715ca62972 3827f0487db5ad12f1beb7aabb4e6bbc278a8145 bffe90496c904a0f95242e1bbfd3709fb1ff5e5d 3b83fe637e8b1f0e0cbac1d53106718f56b6afdc 38b98c653680cd87ecd3060601a57f996c35272e 8091f3a0b8463d41049ed4ade98c79f82c86ebbc 09572681038c344c9ebf15705f4ac4b47ea1589d 2bf3a585185d4e594793d87bb93b364a4c772bf2 74e0985e1bfb22853b75b95dbc795c46ce907e56 27f13a37a0d05dcc6a5f88ab0970bd27d39e46a1 00291118dbb531d15636c809bcb0eca264716043 6556c8d2eef6dda3fce917f756f0e33e54b2084b 7c908eb9a41d46ba9412838bacf8eda31cc51ca2 50a06d0dc48c2e16b48a11e75a450f2892d40876 cdb0471eca6655051701935f18c7e5987b1fe34c a233c49519f9f8dea9e6270700c89d52cf7d8879 90dc7f5b944192da4b7e2f4a3d5e687fe0c9cdd2 6f1b3cf975965e1383e5f5c802cebdc0f4956c2a ed2c300d02acefa2aedd4333ff4a982137c1d4fe ce9a42e8bda50fd5eb91c8dee78f310881d2c7e5 0289b9c23a6998369d6a04dd1c88d3427aec9777 28423d79d4440b0b2a44ad92be305ba37d765012 b159edc6793a2be16028ae28e41d47951c443a4e 0b9c35edb49364e56b93fe46a98a4b8c4802a0eb 341a085fa446b50134af3dbe63efc8b71ce3e534 5f9f182e8a58d0f658e6baf135b5327cbcaf3169 d3e74a7270b8b918d5ddffd1ef411f2aa6e7836b fc88f4b38762eee53906eb170b93ab0bab7d8b0b d0b400c945b41abcb311be9b8eefc52c085f2e43 86e0a2489a7e82bff3eb751094661270a40a2167 0f4b8a3e85706d0372bbbfcb4dfe3adbe53cc141 c4d4424358f257fb92de4c6fbdf76405fff786fe 1a2697e58ee4514d70924adc520593f265f770cb 4e311ec13ad742768f18fbba3f7c33dcc19121d0 da0524a777893df07cb16aa30c812249ac021e9f cf849b73087f25acf6615ca128178740adc6cda8 d7c4fa0d5724b7a89f5b80970e8f62efcc457f8c 312e0d518f37065fb566a7f17efd49cdaa3f3e27 f5d41f28f6442bd7e074efa17785b40ad3c65ba4 c63b53326ced532e855a418e6c1b5ad22f1d3ade f7668a85d152604b9c176621b96b3ef1031506ff b52a48b97ecbb8f7aff187a7743647dfab0670ea 3f1036b61b59e3a99ea6bf1f1d6984a878df6d7b a7c60623158b048244701f104ca4daeb739637a4 e7a3cf7baf41419263ee24690501734602bf1c25 4455f0c3546a07ee2069cda8df50ca9f271070e6 9cc016ecb925d41f3835c07a02e23a5776a77517 8c5207f6a7232c20ad12a0d3171185442faa1295 3aaa953bd6f71c77a3d3ec34ab0f5155f67346db 2298f04a1d40a008a843ac4b0573d1a3234d5f82 a7a90de929f3a37507a3f4d4231c778f79e5fa94 64b96eec7d0aea470f897a3ed0ac9e1b3a680cc5 ab1203999211209da4e737d9fc71581bea9a6bd1 77c25c86af8b61fc825f32257ff51292c0c6e775 6e2ac3b6172dca128c83f21e10a89f4477025da0 29c67fb3ae026594b860c8a381dcca3127c8da24 1e3ae78a693f3ecb01012b19d06f76da16ee37d2 f46618e386dedfae2a95f48cb97a14c86cd2565b 7d28e8ec89254ba0fd4e7612c71f5479e82f9d2a 562d8c338dd975706a7611a1a899ab4a8a3a2911 aacf6bcd0f0cb619906f4199d65a70eaf57ec5a8 7c20724b0d29cee02010a3114575315b9fc9d439 1933981760f50e86e91d15baeedd64bbdb5f2109 f91f4348356285ede39915f0d10ffae11c4871e5 a4201aa6dec755ec824a0e8bb301ce2154e54ec5 2cfcdc64625e36edca686d0e9249b38605bb7ede b1807751219e256867eaac5cc4d8b97a5482978f 86bd6924568d47ac9446f3a04859a8960c5d3894 6f49156bbc763179feac35074f61a683ff4c5a7b e21fe9e14fde16633ae335ab00bf831126f34186 1a2cc84686b728af8836849cee2237e1390d1311 573deb17e682c7de739931967bd2593ec4b1a90e d90627784455bd77addd21e774b816162db2ef12 7144bf27b9d1cffb22ab22782114ff2e5057cc20 915d88e5e60aa08b377eca5c5cbeed6a3d2d4af5 0d956959fa61b770881c1545804fabd7e26edd90 0250e84bf17e287e15517329c01f6d0e346c0710 b18b7260a2fc7543f47febc3f97021f4dd67ba54 89d28156cf561afe0bc8692e611a96631af51433 bf6aa078a709d5afd0c11d1a4e01eb1094c0d09e 23fb8a6b49304a0b8ccf5a10e5bbd603691ba7bc 6eca6ad68644639ef54706363dcbb2d62962da8f 048e21d22e33fb8187532851dad6ce566592156b 1d7d3f58d6666e2a5793a79ea8a28476f961e9c2 ce71f5a05f226b3f68328d4632cd78ac9440d073 d686663d22cb027fae7607acf3bae96ab34018f5 ca10760d2e7ea4f8718741592fd639f589247e53 529efbb4c91365f2f555b3c09ffda946f3843f5d fc2128d7fcd869b238932d50f034b8ff3e8be65c bd527c1946cc92dfeee072542815e71b2e3d1861 b7fa00be65363132f1fd8686bfa0a81b394c0dba ce4c1987a11bcacb7d1ba14f2e9a6bb18d23728b bae7ac48bce5e0566b30a8dd3a766b343b5617a7 faf6f267aead1c2c1f59b051aa7bc12d25dc8941 5db4b0cff96dae30643613a01d13b75196a00c25 2567ff497d40cbc43a1d5d766636b6dd77fc4618 e3f226fde01d96c5e7799884ed4da5324adceca9 68fa3f673633c138596b86ad2ed1befcd0cc63c5 2a44723d4dbea74892d6eee1c8ba463a1f38d014 5b04d18945c547144bf692f6418af5ec25315835 f14018f7edecdff5784ee98e10f1defa6ee75040 5387718c6fbd36b7a6309122f4af68d475a344e8 4c999efdfb6df56e48deec14444442415d8d1ae2 411ef13e7c2bbc43afcfc8fe1a1e251b79a059be 0c2f1121cc8caa5815ea48ccbe7f891f6891f39e 0416d2f167dc852fca9a41ecf398b32409665657 2686550a9919d4af1909b29c5232cedad439c87f 50c20cf8cf7b9fb5caee39f55e339c0ff4a2c0d1 32a72b3e78b6e258eba4a325d3d750f5311921c9 16d93a32e3dcf5013dce8d6f2fbade8c8c0a4c53 ea81a48259804c2ed0aa74d98e1362e5ad7f76ef fb0f6b4be46032e2e38a804822eaccb772e5d9bb 031747a5aaa7614a3982cda14a1714fc9b54d2f4 71b136384b208e85be362d523cc4cc7be9aff202 bee6d2049e2f2c3b87ab5bcc5458ff900ec42850 e8bf5dcdf8cdbb365e9ca8703debdc2ae5f98279 c39dbe1f31435e715cd10bdf83be864e00346699 ee7958bac7a176aa250cdcc23b9bb5c009204015 21832ac226da7e31944df26bf02ff231d2a1a941 0892b92b56531aa3b1c67948bf0cd06152ed361e 2ae08f035fdb5665eab4cef6333344ace528c61e 7adcdb6ff8c6ac321a1f21bfa4123d08c3bc52d5 6abd8e23b8be24af194d97c2fa6bd9e9fed4b29a 8abbc0096da3b6e836d9b7559eb31a73f113bc2f 99ce6e87a3b22c5602d7bbedd43bb40627b63321 c4c3912bad1c67bb70fd009eee18e0a58cdfe929 f7ca5cfa27e433530f2725d44045ea5284fd332a 24266121f1396a3b6ef4d40a7b35a0a31931539c 9c711ba7488d78a91e133083567e56feb446a7c8 7a8254fd05a2c7c89783d65cba544f2899611c73 9f3eb4b7f04c0233d1e62d55c299362f2de4ca52 240aff382def741f306783227d4d46d67e931a36 4f242f09c006e96f8518092b746648b2fdbd43f6 b38935f1cf701b019d1699197004c348e91963ad f17b80105681c2c025d61fe98175c4b83da2d5d2 c40ab0f9a62f02b80fe7604d698db4aa3a8b7713 35f9b6f0b166300041fbc3cde09dbef44b855916 474d1824c474fa731885c76481fefddb6899d0df 57b3b2923a2b77f2f72daa6b0164ee94ee27bad9 b2828c1c8824d4c4bc83d8b2813c395bc0b04f5e 2bbdd1eee680fc111df2f45e64611fd67030e87d 6c110bd398de28613b34555ff2738e74191bb6cd ca0719f44077917f69d92a5cfc9f101806922149 5dcf77d8d0d1676b806c1cc56706c3b738327e9c d54b194550171726ebe7a926bcaf1688b91055de d6af590a8078bb555996ab96dc8845d3d0a3259f 4edad99303b807f03c001b11d03a8b251f1bd214 c64775fd8b50c6d23da284460d7fe9ec5b41d9ab fdb0f101888547285417cca54826a1c99c9f4099 81d04f9326c75c755bb0947b2521b955aedc2afa b6a7a02159eccc7fb40aa119a828e48ae256313a d33cb57e7d891ee9f01dcde3b6366095b4bcf8a1 09b56e2f3631bebdd5581586465fcfe1556ff39f 5b178b2fa94b2fe3d0140d0c841695903cb39bd0 41184e9de97599dacad00d80021c35f2010f9d0f 0d63116b27df2eb7c098625878b7182aaf83089b 433845277ba7a019737dad2050d51c7d38df9316 fcabfeea8f79b610d5547ab2c0d05752f9279ff1 496073d5062e8f286649696fe99d2e7c1460a35d fcb8edee6bcd0652cb43e1f59d967a59ba037940 e71fe80c3a29e08010aeac167d4f4f7db28aae95 d7c3aac296031071e6eebc0420da16ed7bcfe823 d21fee129b4b04b85dc61824fe1a10c06da1a284 98c9aff086461a4120c11b5e3afaf1b68095fef1 90696fe884ed42cb58feae0fd53ad1f4d0281bc7 86034654a8323ae38ecbd1ac6e5424ca7de4f1eb 0519f53ca06264cab66f8b1889ba35f6cb2cf7cb 2e0a56257a15af8dee6ebad55f180591b1c1e18c 2f83de8cffdc059fb9e3db9b86a9a98b1f299b03 0a78a9f56d35e2c03913ea7a5dc8f98294f89ea8 963f76180b9ec05c65fb4e0bdee7d1e642379207 a3b3708134a8956c79929764df7271b2a153f5f0 b43e4a54e2ab646570bc2a08d0ebccd6e15e245b 4676273b888458f1d47f4a7823c9033dc4f3441d 5981f2ed735a2a130dcc743ef9bb6d2ab0b33197 568b4bc902857a4c1666fb5e83c85c1d4b2e1a71 ec097bc1b0194c335dc5745cc5963c45d9682743 7187965a75ca6abeb512a436bc7fcd84640591fd 7e046aa49e70f97aac2adacc5c0bc5f55e52b2a3 f5f741842287e1db81c85c2ed737ae086781ae58 e15af49029189ef18497fd6da3fccd73f07a324b 51bd7f86b611242d0375fefa4fe66dda85fe485f 7b79e3a87b1e1a9478e92d6ea3b5973da4388a82 2db8a0a94efd3d45f2888c96f293670112414533 142e6e78619975bd064a73110b8999fc9fe7ae84 fb513fcc0742390338a30e0df13111bf21de0920 6c2b8fd3a4dadc0f6061c11e0bbc05326d504423 177046a137635a697830f23406d84b72b588784d 2f280d0dda2b85533fedc15e092185c4e648fcf3 1113f42aa748d9e0a27c4663b9d8de1237f95e73 51835957d029d0b82f1a043e3e221f8b13ec2043 a04e890f3751a3c324303b178f45444605351abb 493d60fb16a0f17c598ccc20bb837239eebcaa27 1dc4c94ed07336b0e7f4233cd22342a5898767eb e5b06613f31b89a2a2e58e5963601e5ec6cf16e0 6dc35196ae4a5afda6490abe585bc8d468f1ed2d 901838504cef8c0bd494d27f191a4533b66dede3 3dbb6c7470b7a54e078763501c0db38e4040b047 180572129fb9ad5ca736ac1ba5d78094dc2c68db e5a512eb93663238f0ea85a19bdfec662b101134 c806c4eed541a6b9e39b20fb2484edea4cf26eba 6d64e40776886a264465a9a90e5f7c81797904cf b48fc2c2d64b7c8ae3c4a8d63bd5b3badff1c552 4a43312278c221d2ad313ded043d32d48338cb32 488c9c669c03b266047cc002d04ef012af5f525e efe0504f5f04a349473557e90a7484c4cac294c3 b95158b23ca884322a02be69826a58edb5e3923e 69bc9ad99e462cef1a122afc9852ed89565e1bf2 366e3f84f6409c0a5cd115008659921dcd0716ff 4031786fab83c35d18f2a69bdd0db37e7c4ea33f ba63b9a56d18b4c684ed8dd813f8031502ad545b 6f72d64a6ebdff701c6445812d2974ac9f6e4dbb ee0e10be895fa4e2660917ff87013212fd547a94 8c8cf0896bf80ce5a30fff84a944dd29c550aefb 7723063e36cad83343d8f3d2d6fdd92a23b2c19d)
fi

# Multiple games making use of mfplat broke with 1fceb1213992b79aa7f1a5dc0a72ab3756ee524d
# Prevent crashing in multiple affected games with Derek's implementation: https://raw.githubusercontent.com/wine-staging/wine-staging/0ae7315541c8847d902c9e458a928c4df5520ba6/patches/mfplat-streaming-support/0033-HACK-Switch-between-all-selection-streams-on-MF_SOUR.patch
if [ "$_use_staging" = "true" ] && ( cd "${srcdir}"/"${_stgsrcdir}" && git merge-base --is-ancestor 41e15516bde2e7c96fdb229c17140bf52fb05403 HEAD ) && ( cd "${srcdir}"/"${_stgsrcdir}" && ! git merge-base --is-ancestor 09fdb3b5c97df1b96389f8070fd791560ec670b4 HEAD ); then
  warning "Hotfix: Fix for mfplat breakage in some games"
  _hotfix_mainlinereverts+=(a67d7c15336ea5caa89099952da1fc1998188029 a0a6fad695d2f9d1eb2601725ac27c9a9949026b beb9c6578ad8e21eb4b34366dbc3dff8b8c2ae5d cf4fe13a41b7cc0a624da7741ae528ef21032736 1fceb1213992b79aa7f1a5dc0a72ab3756ee524d)
  _hotfixes+=("$_where"/wine-tkg-patches/hotfixes/mfplat/mfplat-derek-hotfix)
elif [ "$_use_staging" = "true" ] && ( cd "${srcdir}"/"${_winesrcdir}" && git merge-base --is-ancestor 1fceb1213992b79aa7f1a5dc0a72ab3756ee524d HEAD ) && ( cd "${srcdir}"/"${_stgsrcdir}" && ! git merge-base --is-ancestor 41e15516bde2e7c96fdb229c17140bf52fb05403 HEAD ); then
  warning "Hotfix: Fix for mfplat breakage in some games"
  _hotfix_mainlinereverts+=(1fceb1213992b79aa7f1a5dc0a72ab3756ee524d)
  _hotfixes+=("$_where"/wine-tkg-patches/hotfixes/mfplat/mfplat-derek-hotfix)
fi
